<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Расписание ПТК НовГУ</title>
	<style>
		table, td {
			border: 1px solid black;
			border-collapse: collapse;
		}
		td {
			padding: 5px;
		}
		.time {
			margin: 0 auto;
			text-align: center;
		}
	</style>
</head>
<body>
	<h3>Расписание для группы: <select id="groups"></select></h3>
	<div id="container"></div>
	<script src="js/jquery.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script type="text/javascript">
		days = ['Сегодня', 'Завтра'];

		function parser(data) {
			var response = $.parseJSON(data);
			$('#container').html('<table>');
			for (var i = 0 ; i < response.days.length; i++) {
				var content = '<tr><td colspan=2 align="center">' + days[i] + '</td></tr>';
				if (typeof(response.days[i]) == 'string') {
					if (response.days[i] == 'Saturday') {
						day = 'субботу';
					} else {
						day = 'воскресенье';
					}
					content += '<tr><td colspan=2 align="center">' + 'Ничего на ' + day + '</td></tr>';
				} else {
					for (var j = 0; j < response.days[i].schedule.length; j++) {
						time = response.days[i].time[j].split('-');
						content += '<tr><td><p class="time">' + time[0] + '</p><p class="time">' +
							time[1] + '</p></td><td>' + response.days[i].schedule[j] + '</td></tr>';
					}
				}
				$('#container').append(content);
			}
			$('#container').append('</table>');
		}

		function loadSchedule(group) {
			$.ajax({
				url: 'api/index.php' + location.search,
				data: {'group': group, 'short': ''},
				success: parser
			});
		}

		$.ajax({
			url: 'api/groups.php' + location.search,
			success: function(data) {
				var groups = $.parseJSON(data);
				var defaultGroup = $.cookie('group');
				if ($.inArray(defaultGroup, groups) < 0) {
					defaultGroup = groups[0];
					$.cookie('group', defaultGroup, {expires: 365});
				}
				for (var i = 0; i < groups.length; i++) {
					$('#groups').append('<option value="' + groups[i] + '">' + groups[i] + '</option>');
				}
				$('#groups').val(defaultGroup);
				loadSchedule(defaultGroup);
			}
		});

		$('#groups').change(function() {
			loadSchedule($(this).val());
			$.cookie('group', $(this).val(), {expires: 365});
		});
	</script>
	<script type="text/javascript">
		(function (d, w, c) {
			(w[c] = w[c] || []).push(function() {
				try {
					w.yaCounter36039930 = new Ya.Metrika({
						id:36039930,
						clickmap:true,
						trackLinks:true,
						accurateTrackBounce:true
					});
				} catch(e) { }
			});

			var n = d.getElementsByTagName("script")[0],
				s = d.createElement("script"),
				f = function () { n.parentNode.insertBefore(s, n); };
			s.type = "text/javascript";
			s.async = true;
			s.src = "https://mc.yandex.ru/metrika/watch.js";

			if (w.opera == "[object Opera]") {
				d.addEventListener("DOMContentLoaded", f, false);
			} else { f(); }
		})(document, window, "yandex_metrika_callbacks");
	</script>
	<noscript><div><img src="https://mc.yandex.ru/watch/36039930" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
</body>
</html>
